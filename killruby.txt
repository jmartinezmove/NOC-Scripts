#!/bin/bash

WARNING=95.0
Pname="ruby"


#getting process name from top command
ProcessName=$(top -bn1 | awk 'NR==8 {print $12}')

# getting cpu percentage for process
CpuPercent=$(top -bn1 | awk 'NR==8 {print $9}')

#####getting process id
pid=$(top -bn1 | awk 'NR==8 {print $1}')
pid=$pid|cut -c1-5
#########

if (( $(echo "$CpuPercent > $WARNING" | bc -l) ))
    then
       if (( $(echo "$ProcessName == $Pname" | bc -l ) ))
          then
             echo " Process using up CPU is: $ProcessName it is using $CpuPercent percent"
             echo " Killing Process: $ProcessName"
			 kill -9 $pid
             sleep 2
             exit 1
        fi

 elif (( $(echo "$CpuPercent < $WARNING" | bc -l ) )); then

      echo "CPU percent is ok at:" $CpuPercent
 else
    echo "CPU usage couldn't be read"
fi
exit 1